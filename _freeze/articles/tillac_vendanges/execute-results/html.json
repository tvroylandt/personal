{
  "hash": "c295287b008ce8af4f62f06e0d7300e5",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Search your tweets with an automatic pipeline\ndate: \"2020-07-08\"\ndescription: \"Use Github Actions as an orchestrator tool to print your tweets on a table\"\ncategories: [Blog]\nimage: \"\"\ndraft: true\nexecute: \n  eval: false\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Import - filtre à intégrer en amont\ndads_postes <- read_rds(\"data/dads_filtre_05_15.rds\") %>% \n  filter(annee != 2005) %>% \n  mutate(filtre_poste = fct_recode(FILT,\n                           \"Annexe\" = \"2\",\n                           \"Non annexe\" = \"1\"),\n         filtre_poste = fct_relevel(filtre_poste,\n                            \"Annexe\", \"Non annexe\"))\n\n# Construction des périodes d'emplois\nseq_empl <- dads_postes %>% \n  group_by(annee, DATDEB, DATFIN, filtre_poste) %>% \n  count() %>% \n  mutate(n = n * 12)\n\nseq_empl_jour <- tibble(jour = seq(-30, 360, 1)) %>% \n  mutate(join = \"1\") %>% \n  full_join((seq_empl %>% \n               mutate(join = \"1\")),\n            by = \"join\") %>% \n  mutate(ind_ok = case_when(jour >= DATDEB & jour <= DATFIN ~ \"1\",\n                            TRUE ~ \"0\")) %>% \n  filter(ind_ok == \"1\") %>% \n  group_by(annee, jour, filtre_poste) %>% \n  summarise(n = sum(n))  %>% \n  filter(jour > 0)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Moyennes sur 10 ans\nmoy_empl <- dads_postes %>% \n  group_by(filtre_poste) %>% \n  count() %>% \n  ungroup() %>% \n  mutate(part_empl = n / sum(n) * 100)\n\nmoy_jour <- seq_empl_jour %>% \n  group_by(filtre_poste) %>% \n  summarise(n = sum(n)) %>% \n  ungroup() %>% \n  mutate(part_jour = n / sum(n) * 100)\n\nmoy_10ans <- moy_empl %>% \n  left_join(moy_jour, by = (\"filtre_poste\")) %>% \n  mutate_at(vars(part_empl, part_jour), format, \n            decimal.mark = \",\", digits = 0, nsmall = 0) %>% \n  select(filtre_poste, part_empl, part_jour)\n```\n:::\n\n\n\nLes vendanges sont une période l'année où l'emploi saisonnier bondit. De nombreuses personnes sont alors recrutées spécialement pour l'occasion, pour des durées souvent courtes.\n\nOn va s'appliquer ici à mettre en avant quelques caractéristiques de cet emploi lié aux vendanges, à partir des DADS de l'Insee (voir encadré). Le focus est fait sur le métier des ouvriers de la viticulture ou de l'arboriculture fruitière (PCS 691D). La catégorie d'analyse n'est donc pas pure, bien qu'elle soit majoritairement composée de vendangeurs.\n\n## Emplois permanents et saisonniers\n\nAu sein de la profession des ouvriers viticoles et arboriculteurs, deux modalités d'emploi se dessinent :\n\n+ d'un côté des emplois permanents (ou poste non-annexe), à l'année ou sur des périodes longues. En moyenne, sur 10 ans, ils représentent ` filter(moy_10ans, filtre_poste == \"Non annexe\")$part_empl` % des emplois et ` filter(moy_10ans, filtre_poste == \"Non annexe\")$part_jour` % des jours travaillés ;\n+ de l'autre côté des emplois saisonniers (ou poste annexe), sur de courtes périodes, pour les récoltes. De façon, inverse, ils représentent la majorité des emplois, ` filter(moy_10ans, filtre_poste == \"Annexe\")$part_empl` %, mais seulement ` filter(moy_10ans, filtre_poste == \"Annexe\")$part_jour` % des jours travaillés.\n\n## La saisonnalité de l'emploi\n\nDe façon assez logique, ces emplois ne se répartissent pas de la même façon au cours de l'année. Les emplois permanents sont de faits relativement stables selon les périodes, bien qu'on observe un pic au moment des récoltes. Les emplois saisonniers se multiplient au moment des périodes de récolte et notamment pendant les vendanges.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Saisonnalité en fonction du type de poste, en moyenne décennale\nseq_empl_jour %>%\n  group_by(jour, filtre_poste) %>%\n  summarise(n = sum(n)) %>%\n  ungroup() %>%\n  mutate(part_n = n / sum(n)) %>%\n  ggplot() +\n  geom_area(aes(x = jour / 30, y = part_n * 100, fill = filtre_poste),\n            stat = \"identity\", color = \"grey40\", size = 1.1) +\n  geom_curve(\n    data = tibble(\n      x = 5,\n      xend = 8.45,\n      y = 0.45,\n      yend = 0.53\n    ),\n    aes(\n      x = x,\n      y = y,\n      xend = xend,\n      yend = yend\n    ),\n    size = 0.5,\n    curvature = -0.1,\n    arrow = arrow(length = unit(0.01, \"npc\"), type = \"open\")\n  ) +\n  geom_label(\n    data = tibble(x = 4.5, y = 0.4, label = \"La période des vendanges, en septembre, est bien visible\"),\n    aes(\n      x = x,\n      y = y,\n      label = str_wrap(label, 15)\n    ),\n    label.size = NA,\n    size = 5\n  ) +\n  scale_x_continuous(\n    \"\",\n    breaks = seq(0, 11, 1),\n    labels = c(\n      \"Janvier\",\n      \"Février\",\n      \"Mars\",\n      \"Avril\",\n      \"Mai\",\n      \"Juin\",\n      \"Juillet\",\n      \"Août\",\n      \"Septembre\",\n      \"Octobre\",\n      \"Novembre\",\n      \"Décembre\"\n    )\n  ) +\n  scale_y_continuous(\"Part de l'emploi (en %)\",\n                     breaks = seq(0, 0.7, 0.1),\n                     limits = c(0, 0.6)) +\n  scale_fill_manual(\"Type de poste\",\n                    values = c(\"#b22222\", \"#22427c\")) +\n  labs(caption = \"Source : Insee - DADS \\nPart des emplois par date, moyenne décennale 2006-2015 \\nTraitements T.Vroylandt\") +\n  theme_minimal(base_line_size = 1) +\n  theme(\n    text = element_text(family = \"ubuntu\"),\n    axis.text.x = element_text(\n      size = 13,\n      vjust = 0.8,\n      angle = 60\n    ),\n    axis.text.y = element_text(size = 13),\n    axis.title.y = element_text(size = 13),\n    legend.text = element_text(size = 13),\n    legend.title = element_text(size = 13),\n    panel.grid.minor = element_blank(),\n    panel.grid.major.x = element_blank(),\n    panel.grid.major.y = element_line(color = \"grey80\"),\n    plot.caption = element_text(hjust = 0, \n                                size = 11)\n  )\n```\n:::\n\n\n\nPour les postes annexes, la saisonnalité est fortement marquée. On peut toutefois observer des différences selon les années, avec des récoltes plus ou moins tardives, fonction notamment des conditions météorologiques à l'hiver, au printemps et durant tout l'été. Ces phénomènes se répercutent alors sur l'emploi.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Saisonnalité par année sur les dates de début\ndads_postes %>%\n  filter(filtre_poste == \"Annexe\" & DATDEB > 0) %>%\n  ggplot() +\n  geom_boxplot(aes(x = annee, y = DATDEB / 30, group = annee),\n               outlier.alpha = 0.03, fill = \"#b22222\") +\n  geom_curve(\n    data = tibble(\n      x = c(2008.7, 2009.2),\n      y = c(4.3, 4.3),\n      xend = c(2007, 2011),\n      yend = c(7.8, 7.6)\n    ),\n    aes(\n      x = x,\n      y = y,\n      xend = xend,\n      yend = yend\n    ),\n    size = 0.5,\n    curvature = -0.1,\n    arrow = arrow(length = unit(0.01, \"npc\"), type = \"open\")\n  ) +\n  geom_curve(\n    data = tibble(\n      x = 2014,\n      y = 4.6,\n      xend = 2013.1,\n      yend = 8.9\n    ),\n    aes(\n      x = x,\n      y = y,\n      xend = xend,\n      yend = yend\n    ),\n    size = 0.5,\n    curvature = 0.1,\n    arrow = arrow(length = unit(0.01, \"npc\"), type = \"open\")\n  ) +\n  geom_label(\n    data = tibble(x = 2009, y = 3, label = \"2007 et 2011 sont des années de vendanges précoces\"),\n    aes(\n      x = x,\n      y = y,\n      label = str_wrap(label, 18)\n    ),\n    label.size = NA,\n    size = 5\n  ) +\n  geom_label(\n    data = tibble(x = 2014, y = 3.5, label = \"En 2013, les vendanges sont tardives, en octobre\"),\n    aes(\n      x = x,\n      y = y,\n      label = str_wrap(label, 18)\n    ),\n    label.size = NA,\n    size = 5\n  ) +\n  scale_x_continuous(\"\", breaks = seq(2006, 2015, 1)) +\n  scale_y_continuous(\n    \"\",\n    breaks = seq(0, 11, 1),\n    labels = c(\n      \"Janvier\",\n      \"Février\",\n      \"Mars\",\n      \"Avril\",\n      \"Mai\",\n      \"Juin\",\n      \"Juillet\",\n      \"Août\",\n      \"Septembre\",\n      \"Octobre\",\n      \"Novembre\",\n      \"Décembre\"\n    )\n  ) +\n  coord_flip() +\n  labs(caption = \"Source : Insee - DADS \\nDate de début des postes annexes \\nTraitements T.Vroylandt\") +\n  theme_minimal(base_line_size = 1) +\n  theme(\n    text = element_text(family = \"ubuntu\"),\n    axis.text.x = element_text(\n      size = 13,\n      vjust = 0.5,\n      angle = 60\n    ),\n    axis.text.y = element_text(size = 13),\n    panel.grid.minor = element_blank(),\n    panel.grid.major.y = element_blank(),\n    panel.grid.major.x = element_line(color = \"grey80\"),\n    plot.caption = element_text(hjust = 0, \n                                size = 11)\n  )\n```\n:::\n\n\n\n## Caractéristiques géographiques\n\nSelon les départements, les récoltes et en particulier les vendanges, ne débutent pas à la même date.\nOn voit bien que la majorité de l'emploi se concentre dans les départements qui font traditionnellement du vin, que ce soit dans le Sud-Ouest, autour de la Gironde, ou dans la Champagne ou la Bourgogne.\n\nOn remarque aussi que l'emploi a tendance a être plus dispersé dans le temps dans le Sud, notamment du fait des cultures fruitières. Il est par contre particulièrement concentré sur une courte période en Champagne.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Stats par dep\nstats_dep <- dads_postes %>%\n  filter(filtre_poste == \"Annexe\") %>%\n  group_by(DEPT) %>%\n  summarise(\n    date_deb_med = median(DATDEB),\n    date_deb_d1 = quantile(DATDEB, probs = seq(0, 1, 0.1))[2],\n    date_deb_d2 = quantile(DATDEB, probs = seq(0, 1, 0.1))[3],\n    date_deb_d3 = quantile(DATDEB, probs = seq(0, 1, 0.1))[4],\n    date_deb_d4 = quantile(DATDEB, probs = seq(0, 1, 0.1))[5],\n    date_deb_d5 = quantile(DATDEB, probs = seq(0, 1, 0.1))[6],\n    date_deb_d6 = quantile(DATDEB, probs = seq(0, 1, 0.1))[7],\n    date_deb_d7 = quantile(DATDEB, probs = seq(0, 1, 0.1))[8],\n    date_deb_d8 = quantile(DATDEB, probs = seq(0, 1, 0.1))[9],\n    date_deb_d9 = quantile(DATDEB, probs = seq(0, 1, 0.1))[10],\n    n = n()\n  )\n\n# Avec sélection des départements\n# Et on anime les transitions par décile\ndecile_dep <- stats_dep %>%\n  pivot_longer(\n    cols = starts_with(\"date_deb_d\"),\n    names_to = \"decile\",\n    values_to = \"val_decile\"\n  ) %>%\n  filter(n > 30) %>%\n  select(DEPT, decile, val_decile) %>%\n  mutate(\n    decile = str_sub(decile, -2, -1),\n    val_decile = round(val_decile, 0),\n    val_decile = if_else(val_decile < 1, 1, val_decile),\n    mois_trunc = trunc(val_decile / 30),\n    jour = round((val_decile / 30 - mois_trunc) * 30, 0) + 1,\n    mois = fct_recode(\n      as.character(mois_trunc + 1),\n      \"janvier\" = \"1\",\n      \"février\" = \"2\",\n      \"mars\" = \"3\",\n      \"avril\" = \"4\",\n      \"mai\" = \"5\",\n      \"juin\" = \"6\",\n      \"juillet\" = \"7\",\n      \"août\" = \"8\",\n      \"septembre\" = \"9\",\n      \"octobre\" = \"10\",\n      \"novembre\" = \"11\",\n      \"décembre\" = \"12\"\n    ),\n    date = paste(jour, mois, sep = \" \")\n  ) %>%\n  select(DEPT, decile, val_decile, date)\n\n# Jointure\ndecile_dep_shp <- shp_dep %>%\n  left_join(decile_dep %>%\n              bind_rows(tibble(DEPT = unique(decile_dep$DEPT))), by = c(\"DEP\" = \"DEPT\")) %>%\n  mutate(decile = fct_explicit_na(decile, \"NS\"),\n         decile = fct_recode(decile,\n                             \"10 %\" = \"d1\",\n                             \"20 %\" = \"d2\",\n                             \"30 %\" = \"d3\",\n                             \"40 %\" = \"d4\",\n                             \"50 %\" = \"d5\",\n                             \"60 %\" = \"d6\",\n                             \"70 %\" = \"d7\",\n                             \"80 %\" = \"d8\",\n                             \"90 %\" = \"d9\"),\n         date = if_else(is.na(date), \"1 janvier\", date),\n         val_decile = if_else(is.na(val_decile), 1, val_decile),\n         date = fct_reorder(date, val_decile))\n\n# Carte GIF\nanim_carte <- ggplot() +\n  geom_sf(data = decile_dep_shp, aes(fill = decile)) +\n  scale_fill_manual(\"Part des emplois \\nayant débuté\",\n    values = c(\n      \"#f0b0b0\",\n      \"#e37070\",\n      \"#db4545\",\n      \"#d73030\",\n      \"#b22222\",\n      \"#9d1e1e\",\n      \"#871a1a\",\n      \"#721616\",\n      \"#5d1212\",\n      \"grey80\"\n    )\n  ) +\n  labs(title = \"Date : {current_frame}\") +\n  theme_void() +\n  labs(caption = \"Source : Insee - DADS \\nDate de début des postes annexes \\nDépartements avec plus de 30 observations avant pondération sur 10 ans \\nNS : Non significatif \\nTraitements T.Vroylandt\") +\n   theme(\n    text = element_text(family = \"ubuntu\"),\n    legend.text = element_text(size = 13),\n    legend.title = element_text(size = 13),\n    plot.caption = element_text(hjust = 0, \n                                size = 11)\n  ) +\n  transition_manual(date, \n                    cumulative = TRUE)\n\n# Animation\nanimate(anim_carte, fps = 2)\n```\n:::\n\n\n\n## Profils des vendangeurs\n\nSelon qu'il s'agisse de postes saisonniers (annexes) ou permanents (non annexes), les profils des salariés sont bien différents. Dans un cas, on a plutôt affaire à des jeunes, avec davantage de femmes, alors que dans l'autre la pyramide des âges est plus répartie.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndads_demo <- dads_postes %>%\n  mutate(\n    AGE_TR = cut(\n      AGE,\n      breaks = c(0, 19, 23, 27, 31, 35, 39,\n                 43, 47, 51, 55, 59, 63, 67, 150),\n      include.lowest = TRUE,\n      right = FALSE,\n      labels = c(\n        \"Moins de 19 ans\",\n        \"19-23 ans\",\n        \"23-27 ans\",\n        \"27-31 ans\",\n        \"31-35 ans\",\n        \"35-39 ans\",\n        \"39-43 ans\",\n        \"43-47 ans\",\n        \"47-51 ans\",\n        \"51-55 ans\",\n        \"55-59 ans\",\n        \"59-63 ans\",\n        \"63-67 ans\",\n        \"67 ans et plus\"\n      )\n    ),\n    SEXE = fct_recode(SEXE,\n                      \"Homme\" = \"1\",\n                      \"Femme\" = \"2\")\n  )\n\n# Comparaison annexe / non-annexe\ndads_demo_comparaison <- dads_demo %>%\n  group_by(SEXE, AGE_TR, filtre_poste) %>%\n  count() %>%\n  mutate(n = n * 12) %>%\n  group_by(filtre_poste) %>%\n  mutate(part_n = n / sum(n) * 100) %>%\n  filter(AGE_TR != \"00\" & !is.na(AGE_TR)) %>%\n  ungroup()\n\n# Commentaire\ncom_label <- tibble(x = c(\"55-59 ans\", \"59-63 ans\"),\n                    y = c(8.5, 10),\n                    label = c(\"Les postes saisonniers sont plutôt occupés par des jeunes\",\n                    \"Les tranches d'âges sont davantages réparties dans les postes permanents\"),\n                    filtre_poste = c(\"Annexe\", \"Non annexe\"))\n\ncom_fleche <- tibble(x = \"47-51 ans\",\n                     xend = \"19-23 ans\",\n                     y = c(6, 8.5),\n                     yend =c(-6, 10),\n                     filtre_poste = \"Annexe\")\n\n# Fusion\nggplot() +\n  geom_bar(data = filter(dads_demo_comparaison, SEXE == \"Homme\") ,\n    aes(x = AGE_TR, fill = SEXE, y = part_n),\n    stat = \"identity\",\n    position = \"dodge\",\n    width = 2\n  ) +\n  geom_bar(data = filter(dads_demo_comparaison, SEXE == \"Femme\") ,\n    aes(x = AGE_TR, fill = SEXE, y = -part_n),\n    stat = \"identity\",\n    position = \"dodge\",\n    width = 2\n  ) +\n  geom_curve(\n    data = com_fleche,\n    aes(\n      x = x,\n      y = y,\n      xend = xend,\n      yend = yend\n    ),\n    size = 0.5,\n    curvature = -0.1,\n    arrow = arrow(length = unit(0.02, \"npc\"), \n                  type = \"open\")\n  ) +\n  geom_label(\n    data = com_label,\n    aes(\n      x = x,\n      y = y,\n      label = str_wrap(label, 15)\n    ),\n    size = 5,\n    label.size = NA\n  ) +\n  scale_x_discrete(\"\") +\n  scale_y_continuous(\n    name = \"Part des emplois (en %)\",\n    breaks = seq(-12, 14, 2),\n    labels = paste0(as.character(c(\n      seq(12, 0,-2), seq(2, 14, 2)\n    )))\n  ) +\n  scale_fill_manual(\"Sexe\",\n                    values = c(\"Homme\" = \"#22427c\", \"Femme\" = \"#b22222\")) +\n  coord_flip() +\n  facet_grid(cols = vars(filtre_poste)) +\n  labs(caption = \"Source : Insee - DADS \\nMoyenne 2006-2015 \\nLa construction des données impose des classes d'âges quadriennales \\nTraitements T.Vroylandt\") +\n  theme_minimal(base_line_size = 1) +\n  theme(\n    text = element_text(family = \"ubuntu\"),\n    axis.text.x = element_text(\n      size = 13,\n      vjust = 1,\n      angle = 60\n    ),\n    axis.title.x = element_text(size = 13),\n    axis.text.y = element_text(size = 13),\n    legend.text = element_text(size = 13),\n    legend.title = element_text(size = 13),\n    strip.text = element_text(size = 13),\n    panel.grid.minor = element_blank(),\n    panel.grid.major.x = element_line(color = \"grey80\"),\n    panel.grid.major.y = element_blank(),\n    plot.caption = element_text(hjust = 0,\n                                size = 11)\n  )\n```\n:::\n\n\n\n> ## Méthodologie\n>\n> La déclaration annuelle de données sociales (DADS) est une formalité administrative obligatoire pour toute entreprise employant des salariés. Elle contient des informations relatives à l'établissement et au salarié.\n> Ces données sont recueillies par l'Insee qui constitue des fichiers d'analyse (https://www.insee.fr/fr/statistiques/3536754). Le fichier utilisé ici est le fichier \"postes\" où chaque enregistrement correspond à un poste, c'est-à-dire à la consolidation des périodes de travail d'un salarié dans un même établissement.\n>\n> Un poste est catégorisé en fonction de plusieurs critères pour analyser si il relève d'un \"vrai\" emploi ou d'un poste non annexe, par exemple saisonnier ou de très courte durée. Un poste est dit non-annexe si :\n>\n> + la rémunération nette est supérieure à 3 SMIC mensuels ;\n> + ou le nombre d'heures salariées est supérieur à 120 et la durée de travail supérieure à 30 jours.\n>\n> Dans les autres cas, le poste est considéré comme annexe.\n>\n> ## Code et analyse\n>\n> L'ensemble de l'analyse et du code est disponible sur [github](https://github.com/tvroylandt/vendanges).\n>\n> Les remarques, commentaires et propositions sont les bienvenus : tvroylandt@gmail.com\n>\n\n> ## Bibliographie\n>\n> Ces quelques publications portent sur des sujets similaires ou proches.\n>\n> + Sur l'emploi saisonnier, à partir de la Déclaration Sociale Nominative (DSN) : [Limon, E. (2019), \"Quelle place occupe l'emploi saisonnier en France ?\", *Dares Analyses*, n\\°057, décembre](https://dares.travail-emploi.gouv.fr/IMG/pdf/dares_analyses_emploi_saisonnier_france_2018-2019.pdf) avec un [focus sur les vendanges](https://dares.travail-emploi.gouv.fr/dares-etudes-et-statistiques/etudes-et-syntheses/autres-publications/article/emplois-saisonniers-le-cas-des-vendanges) ;\n> + Une publication large sur le sujet, de France Stratégie : [Réseau Emploi, Compétences (2016), « L’emploi saisonnier : enjeux et perspectives », Document de travail, France Stratégie, n\\°06, juillet](https://www.strategie.gouv.fr/publications/lemploi-saisonnier-enjeux-perspectives) ;\n> + Sur le même sujet, en Occitanie : [Bonzi, A., Dotta, D., Fiche, D., Brossier, P. (2017), « Emploi salarié saisonnier - Une offre variée tout au long de l’année », Insee Analyses Occitanie, n\\°49](https://www.insee.fr/fr/statistiques/3057298) ;\n> + Sur la filière viti-vinicole, ici en Bourgogne-Franche-Comté : [Adrover, S., Bouriez, M., Froissart, P. (2016), « Bourgogne-Beaujolais-Savoie-Jura : une filière viti-vinicole intégrée qui s’appuie sur plus de 8 700 établissements », Insee Analyses Bourgogne-Franche-Comté, n\\°12](https://www.insee.fr/fr/statistiques/2415454) ;\n> + Sur les conditions de travail dans le domaine des vendanges : [Mutualité Sociale Agricole (2015), « Les expositions professionnelles des salariés agricoles en viticulture », SUMER Agricole 2010, n\\°10](https://ssa.msa.fr/wp-content/uploads/2019/04/11646-Fiche-10-Expositions-professionnelles-des-salaries-agricoles-en-viticulture.pdf).\n>",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}