{
  "hash": "61b3a724afbed7b213ab55bcd06efa77",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Search your tweets with an automatic pipeline\ndate: \"2020-07-08\"\ndescription: \"Use Github Actions as an orchestrator tool to print your tweets on a table\"\ncategories: [Blog]\nimage: \"\"\ndraft: true\nexecute: \n  eval: false\n---\n\n---\ntitle: \"Fast Rmarkdown Theming with `thematic` and `bootstraplib`\"\nauthor: \"Thomas Vroylandt\"\ndate: \"05/06/2020\"\noutput: html_document\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(DiagrammeR)\nlibrary(here)\nlibrary(knitr)\nlibrary(tidyverse)\nlibrary(kableExtra)\n```\n:::\n\n\n\nTheming in Rmarkdown can be hard. You first made some custom CSS or use a provided theme but your figures didn't change and you have to style your `ggplot2` theme. And after it you change your mind (or your boss do) and you need to move this color shade to lighter one. So you change your theme, but forgot to change it in all your CSS and something is going wrong. Same goes for fonts...\n\nSounds familiar ? Theming is a common problem, because it involves lot of differents elements which aren't ruled by the same command. Your process look like this.\n\n<center>\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrViz(\"\ndigraph {\n\n  graph [overlap = true, fontsize = 10, rankdir = LR]\n\n  node [shape = oval,\n        fontname = Lato,\n        color = '#000000',\n        fontcolor = '#000000']\n    rmd [label = 'RMarkdown']\n    ggplot [label = 'gglot2 theme']\n    css [label = 'Custom CSS']\n    output [label = 'Output document']\n\n  edge [arrowhead = vee,\n        arrowsize = 0.5,\n        color = '#000000']\n    rmd -> {ggplot css}\n    {ggplot css} -> output\n  }\n      \")\n```\n:::\n\n\n</center>\n\nThanks to the new `thematic` package (https://github.com/rstudio/thematic) and the `bootstraplib` package (https://github.com/rstudio/bootstraplib), you can fastly build themes for your documents without the problems mentioned above.\n\n## Style your graph theme with `thematic`\n\n<center>\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngrViz(\"\ndigraph {\n\n  graph [overlap = true, fontsize = 10, rankdir = LR]\n\n  node [shape = oval,\n        fontname = Lato,\n        color = '#000000',\n        fontcolor = '#000000']\n    rmd [label = 'RMarkdown']\n    thematic [label = 'thematic rules', \n              color = '#741336', \n              fontcolor = '#741336',\n              penwidth = 2.5]\n    css [label = 'Custom CSS']\n    output [label = 'Output document']\n\n  edge [arrowhead = vee,\n        arrowsize = 0.5,\n        color = '#000000']\n    rmd -> css\n    rmd -> thematic [color = '#741336']\n    thematic -> output [color = '#741336']\n    css -> output\n  }\n      \")\n```\n:::\n\n\n</center>\n\nYou can style six differents elements :\n\n+ `bg` : the background color, here <b style=\"background-color:#F4F4E2\">#F4F4E2</b> ;\n+ `fg` : the foreground color, here <b style=\"background-color:#4c4c4c;color:white\">#4c4c4c</b> ;\n+ `accent` : the accent color, here <b style=\"background-color:#741336;color:white\">#741336</b>. It will also be used to create a sequential palette ;\n+ `font` : the font you want to use, here <b style=\"font-family:'Special Elite'\">Special Elite</b>. You can go further by using `font_spec()` ;\n+ `qualitative` : the qualitative palette you want to use ;\n+ `sequential` : the sequential palette, which can be controlled using `sequential_gradient()`. By default, it creates a palette from a mix between your background color and your accent color to a mix between your foreground color and your accent color.\n\nYou just have to use `thematic_on()` with your parameters to use it.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(thematic)\nlibrary(ggplot2)\nlibrary(tibble)\n\nthematic_on(\n  bg = \"#F4F4E2\",\n  fg = \"#4c4c4c\",\n  accent = \"#741336\",\n  font = font_spec(\"Special Elite\", scale = 0.5),\n  qualitative = paletteer::paletteer_d(\"dutchmasters::milkmaid\"),\n  sequential = sequential_gradient(0.5, 0.75)\n)\n```\n:::\n\n\n\nAfter that, just make a normal plot like you are used to.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(tibble(mtcars,\n              model = rownames(mtcars)),\n       aes(x = model, y = mpg, fill = disp)) +\n  geom_col() +\n  geom_text(aes(label = disp), \n            position = position_stack(vjust = 1.1)) +\n  coord_flip() +\n  labs(title = \"A barplot with mtcars\",\n       caption = \"Source : mtcars data\")\n```\n:::\n\n\n\nYou can add a theme to your graph but will need some further coding. But you need to know that the last element overlap your styling. Because complete themes have fonts and/or colors, they may replace your styling. If you want to keep your theme, you have to set it before to call `thematic_on()` through a `theme_set(theme_minimal())` as an example (see https://github.com/rstudio/thematic/issues/16).\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(iris, aes(x = Sepal.Length, y = Sepal.Width, color =  Species)) +\n  geom_point(size = 1.1) +\n  geom_smooth() +\n  labs(title = \"A nice scatterplot for iris\",\n       caption = \"Source : Iris data\") +\n  theme_minimal(base_family = thematic_get_option(\"font\")$families,\n                base_size = thematic_get_option(\"font\")$scale * 11,\n                base_line_size = 1.1)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nthematic_off()\n```\n:::\n\n\n\n`thematic` may work with interactive graph packages like `plotly` or `ggiraph` if you use some special feature (see  https://github.com/rstudio/shiny/pull/2740 and https://github.com/rstudio/thematic/blob/8ed47c589dd4cb611823a958b46f3ed029685bcf/vignettes/Shiny.Rmd#L69)\n\n## Use `bootstraplib` for Rmarkdown theming\n\n<center>\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngrViz(\"\ndigraph {\n\n  graph [overlap = true, fontsize = 10, rankdir = LR]\n\n  node [shape = oval,\n        fontname = Lato,\n        color = '#000000',\n        fontcolor = '#000000']\n    rmd [label = 'RMarkdown']\n    ggplot [label = 'gglot2 theme']\n    bootstraplib [label = 'bootstraplib', \n                  color = '#741336', \n                  fontcolor = '#741336',\n                  penwidth = 2.5]\n    output [label = 'Output document']\n\n  edge [arrowhead = vee,\n        arrowsize = 0.5,\n        color = '#000000']\n    rmd -> ggplot \n    rmd -> bootstraplib [color = '#741336']\n    bootstraplib -> output [color = '#741336']\n    ggplot -> output\n  }\n      \")\n```\n:::\n\n\n</center>\n\nIt calls Bootstrap and allow you to style directly your document (RMarkdown or Shiny) from R using Sass. You can do a lot with this package. But we will only cover some part of it.\n\nFirst you need to reference the use of Bootstrap in the YAML header of your Rmd.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n---\noutput:\n  html_document:\n    bootstrap_version: 4+3\n---\n```\n:::\n\n\n\nAfter that you can use some functions to style your main elements :\n\n+ `bs_theme_base_colors()` allows you to set you background (with `bg`) and foreground (with `fg`) colors ;\n+ `bs_theme_accent_colors()` for the accent colors ;\n+ `bs_theme_fonts()` for the fonts.\n\nYou can also add some hand-made rules with `bs_theme_add_variables()`. As an example `bs_theme_add_variables(\"font-size-base\" = \"0.9rem\")` will style the size of your fonts.\n\nIf you want to use Google Fonts, you may need the `gfonts` package, made by dreamRs (https://github.com/dreamRs/gfonts). It offers simple functions to deal with Google Fonts.\n\nAs an example, here is the code chunk which creates the document just below.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# bootstraplib part\nlibrary(bootstraplib)\nlibrary(gfonts)\n\n# setup and use font\n# the setup has to be done once\nsetup_font(\"special-elite\", \"www/\")\nuse_font(\"special-elite\", \"www/css/special-elite.css\")\n\nbs_theme_fonts(base = \"Special Elite\")\n\n# font-size\nbs_theme_add_variables(\"font-size-base\" = \"0.9rem\")\n\n# colors\nbs_theme_base_colors(bg = \"#F4F4E2\",\n                     fg = \"#4c4c4c\")\n\nbs_theme_accent_colors(primary = \"#741336\")\n```\n:::\n\n\n\n<iframe \n  width = \"100%\"\n  height= 500px\n  src =\"https://tillac.github.io/fast_rmd_theming/examples/bootstraplib_gfonts.html\">\n</iframe>\n\nYou need to keep in mind two things, when using `bootstraplib` for R Markdown :\n\n+ The package doesn't work yet with `xaringan` and `pagedown` for the moment, because they are not made with Bootstrap, and strangely with `flexdashboard`. However you can use the excellent `xaringanthemer` for your presentation (https://github.com/gadenbuie/xaringanthemer).\n\n+ You will need to style your table manually. For the moment, only `kable` works well. This comes from the tables packages CSS behavior. The other packages I tested all failed on one part :\n\n  + `gt` has the font family only ;\n  + `reactable` has the font size, family and color ;\n  + `flextable` has the right background color but not the font size/family/color.\n\n## Forging a theme with both packages\n\n<center>\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngrViz(\"\ndigraph {\n\n  graph [overlap = true, fontsize = 10, rankdir = LR]\n\n  node [shape = oval,\n        fontname = Lato,\n        color = '#000000',\n        fontcolor = '#000000']\n    rmd [label = 'RMarkdown']\n    thematic [label = 'thematic rules', \n              color = '#741336', \n              fontcolor = '#741336',\n              penwidth = 2.5]\n    bootstraplib [label = 'bootstraplib', \n                  color = '#741336', \n                  fontcolor = '#741336',\n                  penwidth = 2.5]\n    output [label = 'Output document']\n\n  edge [arrowhead = vee,\n        arrowsize = 0.5,\n        color = '#741336']\n    rmd -> bootstraplib -> thematic -> output\n  }\n      \")\n```\n:::\n\n\n</center>\n\nIf you use `thematic` after `bootstraplib` in a Rmarkdown document (it's also true for Shiny), it will retrieve the styling you passed and use them. That's a very powerful feature because you will only need to style your document once.\n\nThe only thing you need to care about is the font. You have to set it to `auto` inside `thematic_on()` to get it nicely.\n\nHere are the corresponding functions between the two packages :\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntibble(\n  name = c(\n    \"Background color\",\n    \"Foreground color\",\n    \"Accent color\",\n    \"Font family\",\n    \"Font size\",\n    \"Sequential palette\",\n    \"Qualitative palette\"\n  ),\n  thematic = c(\n    \"`bg`\",\n    \"`fg`\",\n    \"`accent`\",\n    \"`font`\",\n    \"`font_spec(scale = )`\",\n    \"`sequential`\",\n    \"`qualitative`\"\n  ),\n  bootstraplib = c(\n    \"`bs_theme_base_colors(bg = )`\",\n    \"`bs_theme_base_colors(fg = )`\",\n    \"`bs_theme_accent_colors(primary = )`\",\n    \"`bs_theme_fonts(base = )`\",\n    \"`bs_theme_add_variables('font-size-base' = )`\",\n    \"\",\n    \"\"\n  ),\n  both = c(\n    \"auto\",\n    \"auto\",\n    \"auto\",\n    \"`font_spec('auto')`\",\n    \"`font_spec('auto', scale = )`\",\n    \"auto\",\n    \"\"\n  ),\n  info = c(\n    \"\",\n    \"\",\n    \"\",\n    \"May need `gfonts`\",\n    \"\",\n    \"Calculated from background, foreground and accent color\",\n    \"Manual\"\n  )\n) %>%\n  kable(\n    \"html\",\n    col.names = c(\n      \"Feature\",\n      \"Using `thematic`\",\n      \"Using `bootstraplib`\",\n      \"Using both\",\n      \"Additional infos\"\n    )\n  ) %>%\n  kable_styling()\n```\n:::\n\n\n\nAs an example, if you use both packages together.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# bootstraplib part\nlibrary(bootstraplib)\nlibrary(gfonts)\nlibrary(thematic)\n\n# setup and use fonts - google fonts\n# the setup has to be done once\nsetup_font(\"special-elite\", \"www/\")\nuse_font(\"special-elite\", \"www/css/special-elite.css\")\nbs_theme_fonts(base = \"Special Elite\")\n\n# font-size\nbs_theme_add_variables(\"font-size-base\" = \"0.9rem\")\n\n# colors\nbs_theme_base_colors(bg = \"#F4F4E2\",\n                     fg = \"#4c4c4c\")\n\nbs_theme_accent_colors(primary = \"#741336\")\n\n# thematic part\nthematic_on(font = font_spec(\"auto\", scale = 0.5))\n```\n:::\n\n\n\n<iframe \n  width = \"100%\"\n  height= 500px\n  src =\"https://tillac.github.io/fast_rmd_theming/examples/bootstraplib_thematic.html\">\n</iframe>\n\n## Conclusion\n\nThis two packages don't do everything but it's a good step if you don't want to spend a lot of time styling your RMarkdown document. It could also be a first step to more personalized styling as you can export it.\n\nI really like the \"control tower\" approach. It doesn't force you to repeat your styling and makes it really easier to change the style.\n\n## Some ressources to go further\n\nTo learn more about `thematic`, the website present a series of good vignettes. You can also have a look at a presentation made by Carson Sievert, one of the package's author :\n\n+ https://rstudio.github.io/thematic/ ;\n+ https://bit.ly/thematic-talk.\n\nIf you want to learn more about `bootstraplib`, I can recommand you the website and the talks of Joe Cheng at the last rstudio::conf.\n\n+ https://rstudio.github.io/bootstraplib/ ;\n+ https://resources.rstudio.com/rstudio-conf-2020/styling-shiny-apps-with-sass-and-bootstrap-4-joe-cheng?prevItm=0&prevCol=6275649&ts=6836.\n\n## Acknowledgements\n\nI would like to thank [Christophe Dervieux](https://twitter.com/chrisderv) and [Romain Lesur](https://twitter.com/rlesur) for their big help with this articles.",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}